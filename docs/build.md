# Build Process

## Environment Files

Credentials are stored in `.env.*.local` files (gitignored):

- `.env.dev.local` - Development R2 credentials
- `.env.prod.local` - Production R2 credentials

Format:
```
R2_ACCOUNT_ID=...
R2_ACCESS_KEY_ID=...
R2_SECRET_ACCESS_KEY=...
R2_BUCKET_NAME=...
APP_NAME=...
```

- `APP_NAME` is `ritualdev` for dev, `ritual` for prod (determines user data folder)

These values are injected at build time via ldflags.

## Quick Build

Use the PowerShell build script:

```powershell
# Development build
.\build.ps1 dev

# Production build
.\build.ps1 prod
```

This will:
1. Read credentials from `.env.{env}.local`
2. Run `go generate` for resources
3. Build `ritual_{env}.exe` with embedded credentials

## Version Management

Version is defined in `internal/config/config.go` (single source of truth):

```go
const (
    VersionMajor = 1
    VersionMinor = 0
    VersionPatch = 0
)
```

The build script reads these values and generates:
- `cmd/cli/versioninfo.json` - Windows version info (generated, gitignored)
- `cmd/cli/resource.syso` - Compiled resource (generated, gitignored)

To update version, edit `config.go` and rebuild.

## Windows Executable Branding

The project uses [goversioninfo](https://github.com/josephspurrier/goversioninfo) to embed Windows version info and icon into the executable.

### Prerequisites

Install goversioninfo:
```bash
go install github.com/josephspurrier/goversioninfo/cmd/goversioninfo@latest
```

### Files

- `internal/config/config.go` - Version constants (source of truth)
- `assets/baiki-dev.ico` - Application icon (dev build)
- `assets/baiki-prod.ico` - Application icon (prod build)
- `cmd/cli/versioninfo.json` - Generated by build.ps1 (gitignored)
- `cmd/cli/resource.syso` - Generated by go generate (gitignored)
