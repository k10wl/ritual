# R.I.T.U.A.L. Cursor Rules
# Replicate Instances, Track Updates, Archive Legacy

## Documentation Integration
- **PRIMARY REFERENCE**: Always consult @structure.md for complete project structure and architecture
- Reference docs/overview.md for system architecture
- Reference docs/coding-practices.md for NASA JPL Power of Ten defensive programming standards
- Link diagrams from docs/ritual.drawio for visual context
- Maintain README.md as primary entry point
- All code changes must align with documented architecture in structure.md
- **MANDATORY**: Update docs/progress.md when implementing components or completing tasks

## Test-Driven Development (TDD) Enforcement
- Write tests before implementation
- Follow Red-Green-Refactor cycle
- All public methods require unit tests
- Integration tests for external dependencies
- Test coverage minimum 80%

## Hexagonal Architecture Patterns
- Domain layer: Core business logic (Molfar, Librarian, Validator)
- Application layer: Use cases and orchestration
- Infrastructure layer: External adapters (Storage, Minecraft API)
- Ports: Interfaces defining contracts
- Adapters: Implementations of ports

## Component Structure
**See @structure.md for complete directory structure and detailed component descriptions**

Key components per structure.md:
- **Core Domain Layer** (`internal/core/domain/`): manifest.go, server.go, world.go
- **Ports Layer** (`internal/core/ports/`): ports.go with all interfaces
- **Services Layer** (`internal/core/services/`): molfar.go, librarian.go, validator.go
- **Adapters Layer** (`internal/adapters/`): cli.go, fs.go, r2.go, minecraft.go

## Coding Standards
- Use dependency injection
- Implement interfaces for all external dependencies
- Separate concerns by layer
- No direct external API calls in domain layer
- Mock external dependencies in tests
- **MANDATORY**: Follow NASA JPL Power of Ten defensive programming standards per docs/coding-practices.md
- **CRITICAL**: All functions must validate nil parameters and include â‰¥2 assertions
- **ZERO TOLERANCE**: No ignored errors, all return values must be checked
- **STATIC ANALYSIS**: All code must pass golangci-lint with zero warnings

## File Naming Conventions
**Follow conventions defined in @structure.md**

Per structure.md guidelines:
- Use concise names: `fs.go` not `filesystem.go`
- Technology-specific: `r2.go`, `minecraft.go`
- Avoid underscores: Use camelCase for Go conventions
- Domain entities: `manifest.go`, `server.go`, `world.go`
- Services: `molfar.go`, `librarian.go`, `validator.go`
- Adapters: `cli.go`, `fs.go`, `r2.go`, `minecraft.go`
- Tests: `entity_test.go`

## Prohibited Patterns
- No if-else chains (use strategy pattern)
- No direct external API calls in domain
- No business logic in infrastructure layer
- No dependencies from domain to infrastructure

## Required Patterns
- Repository pattern for data access
- Service layer for business logic
- Factory pattern for object creation
- Observer pattern for events
- Command pattern for operations

## Documentation Requirements
- Each component must have GoDoc comments
- Architecture decisions must be documented
- API contracts must be specified
- Error handling strategies documented
- **Always reference @structure.md for architectural context and component relationships**
- Update structure.md when adding new components or changing architecture

## Structure.md Authority
- **@structure.md is the authoritative source for project structure**
- All architectural decisions must align with structure.md definitions
- When in doubt about component placement or naming, consult structure.md first
- Structure.md contains detailed examples and implementation patterns
- Any structural changes require updating both code and structure.md documentation
